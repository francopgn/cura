<!DOCTYPE html>
<html>
<head>
    <script src="https://sf-cdn.coze.com/obj/unpkg-va/flow-platform/chat-app-sdk/1.2.0-beta.10/libs/oversea/index.js"></script>
    <style>
        /* ESTILOS FORZADOS PARA VISIBILIDAD */
        #force-visible * {
            visibility: visible !important;
            opacity: 1 !important;
            display: block !important;
            position: relative !important;
            z-index: 9999 !important;
        }
        
        #force-visible iframe {
            width: 100% !important;
            height: 100% !important;
            border: 3px solid red !important; /* Para verlo claramente */
        }
        
        #debug-view {
            position: fixed;
            top: 10px;
            right: 10px;
            background: white;
            border: 1px solid #ccc;
            padding: 10px;
            z-index: 10000;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div id="debug-view">
        <button onclick="inspect()">üîç Inspeccionar</button>
        <div id="debug-info"></div>
    </div>
    
    <div id="force-visible" style="width:800px; height:600px; margin:50px auto; border:2px solid blue;">
        <div id="coze-target"></div>
    </div>
    
    <script>
        async function init() {
            // 1. Primero verifica si el SDK est√° cargado
            console.log('CozeWebSDK:', CozeWebSDK);
            console.log('M√©todos disponibles:', Object.keys(CozeWebSDK));
            
            // 2. Prueba diferentes m√©todos de inicializaci√≥n
            const methods = ['WebChatClient', 'init', 'create'];
            let success = false;
            
            for (const method of methods) {
                if (CozeWebSDK[method]) {
                    console.log(`Probando m√©todo: ${method}`);
                    try {
                        if (method === 'WebChatClient') {
                            const client = new CozeWebSDK.WebChatClient({
                                config: {
                                    bot_id: '7596429833782214709',
                                    container: '#coze-target',
                                    position: 'embedded',
                                    auto_open: true
                                },
                                auth: {
                                    type: "token",
                                    token: await getToken(),
                                    onRefreshToken: getToken
                                },
                                userInfo: { id: 'test', nickname: 'Test' }
                            });
                            success = true;
                            console.log('‚úÖ WebChatClient creado');
                        } else if (method === 'init') {
                            CozeWebSDK.init({
                                config: {
                                    bot_id: '7596429833782214709',
                                    container: '#coze-target',
                                    position: 'embedded'
                                },
                                userInfo: { id: 'test', nickname: 'Test' }
                            });
                            success = true;
                            console.log('‚úÖ init() ejecutado');
                        }
                    } catch (e) {
                        console.log(`‚ùå ${method} fall√≥:`, e.message);
                    }
                }
            }
            
            if (!success) {
                document.getElementById('coze-target').innerHTML = 
                    '<h3>Error: No se pudo inicializar el SDK</h3>' +
                    '<p>Prueba:</p>' +
                    '<ol>' +
                    '<li>Verificar que el SDK se carg√≥ correctamente</li>' +
                    '<li>Revisar la consola para errores CORS</li>' +
                    '<li>Contactar a Coze support</li>' +
                    '</ol>';
            }
        }
        
        async function getToken() {
            try {
                const res = await fetch('/api/coze-token');
                const data = await res.json();
                return data.token;
            } catch {
                return 'dummy_token_' + Date.now();
            }
        }
        
        function inspect() {
            const target = document.getElementById('coze-target');
            const info = document.getElementById('debug-info');
            
            info.innerHTML = `
                <strong>Contenedor:</strong> ${target.id}<br>
                <strong>Children:</strong> ${target.children.length}<br>
                <strong>HTML:</strong> ${target.innerHTML.substring(0, 200)}...
            `;
            
            // Buscar iframes en toda la p√°gina
            const iframes = document.querySelectorAll('iframe');
            console.log('Iframes encontrados:', iframes.length);
            iframes.forEach((iframe, i) => {
                console.log(`Iframe ${i}:`, {
                    src: iframe.src,
                    style: iframe.style.cssText,
                    parent: iframe.parentElement.id
                });
            });
        }
        
        window.onload = init;
    </script>
</body>
</html>
