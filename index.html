<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/png" href="favicon.png" />
  <title>Ley C.U.R.A. | Diseñando el futuro de la Salud Pública Argentina</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@600&family=Vazirmatn:wght@400;700&family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            cura: { primary: '#004E85', primaryDark: '#00345C', card: '#065D9B', accent: '#00C2FF', accentLight: '#59D2FF' }
          },
          fontFamily: { sans: ['Inter', 'sans-serif'] }
        }
      }
    }
  </script>

<style>
  /* --- ESTILOS BASE --- */
  .modal-backdrop { opacity: 0; transition: opacity 0.25s ease; }
  .modal-backdrop.show { opacity: 1; }
  .modal-card { transform: scale(0.9) translateY(10px); opacity: 0; transition: transform 0.25s ease, opacity 0.25s ease; }
  .modal-card.show { transform: scale(1) translateY(0); opacity: 1; }

  /* --- TARJETA 3D --- */
  .perspective-container { perspective: 1500px; }
  .card-container {
    position: relative; width: 100%; max-width: 450px;
    aspect-ratio: 1.58 / 1; margin: 0 auto; z-index: 20;
    container-type: inline-size;
  }
  .card-inner {
    position: relative; width: 100%; height: 100%; text-align: center;
    transition: transform 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
    transform-style: preserve-3d; cursor: pointer;
  }
  .card-inner.is-flipped { transform: rotateY(180deg); }
  .card-face {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    backface-visibility: hidden; border-radius: 18px; overflow: hidden;
    transform: translateZ(0); box-shadow: 0 20px 40px -5px rgba(0,0,0,0.4);
    -webkit-mask-image: -webkit-radial-gradient(white, black);
  }
  .card-bg-img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: 1; }
  .card-front { z-index: 2; }
  .card-back { z-index: 1; transform: rotateY(180deg); }
  @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
  .animate-float { animation: float 6s ease-in-out infinite; }
  .card-container:hover .animate-float { animation-play-state: paused; }

  /* --- CAPA DE DATOS --- */
  .card-data-layer {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    z-index: 10; pointer-events: none; color: white;
  }
  .centered-data {
    display: flex; flex-direction: column; justify-content: center; align-items: center;
    text-align: center; height: 100%; line-height: 1.2;
  }

  /* ====== POSICIONES CALIBRADAS (Ref: 1411x913px) ====== */
  /* FRENTE */
  .pos-nombre-front {
    position: absolute; left: 2.00%; top: 15%;
    font-family: 'Vazirmatn', sans-serif; font-weight: 700;
    font-size: 4.5cqw; text-align: left; line-height: 1;
  }
  .pos-dni-front {
      position: absolute; left: 2.00%; top: 21.06%;
      font-family: 'Vazirmatn', sans-serif; font-weight: 400;
      font-size: 3cqw; text-align: left;
  }
  .pos-sangre {
      position: absolute; left: 94.88%; top: 9.19%; transform: translate(-50%, -50%);
      font-family: 'Roboto', sans-serif; font-weight: 600; color: #0c4e82; font-size: 4cqw;
  }
  .data-block {
      position: absolute; font-family: 'Open Sans', sans-serif; font-weight: 600;
      font-size: 2.1cqw; text-transform: uppercase; width: 27%; height: 11%;
  }
  .block-alergias { left: 3.8%; top: 34%; }
  .block-medicamentos { left: 3.6%; top: 53.7%; }
  .block-antecedentes { left: 3.9%; top: 70%; }
  .block-operaciones { left: 36.6%; top: 34%; height: 22%; font-size: 2cqw; }
  .block-fecha-nac { left: 69%; top: 35.3%; font-weight: 700; font-size: 2.3cqw; }
  .block-domicilio { left: 69.9%; top: 52.9%; text-transform: none; font-size: 2cqw; font-weight: 600; }
  .block-contactos { left: 69.8%; top: 72.4%; }

  /* DORSO */
  .pos-nombre-back {
      position: absolute; top: 18%; left: 6%;
      font-family: 'Vazirmatn', sans-serif; font-weight: 400; font-size: 3.5cqw; text-align: left;
  }
  .pos-dni-back {
      position: absolute; top: 26%; left: 6%;
      font-family: 'Open Sans', sans-serif; font-weight: 400; font-size: 2.5cqw; text-align: left;
  }
  .pos-id-number {
      position: absolute; bottom: 18%; left: 0; right: 0; text-align: center;
      font-family: 'Open Sans', sans-serif; font-weight: 400; font-size: 2.8cqw; letter-spacing: 0.05em;
  }
</style>

</head>
<body class="font-sans bg-cura-primary text-white overflow-x-hidden">

  <div class="w-full bg-yellow-50 text-center text-xs text-yellow-900 py-2 px-4">
    La ley se encuentra en revisión técnica y estará disponible próximamente en la web.
  </div>

  <header class="sticky top-0 z-30 bg-cura-primaryDark text-white border-b border-cura-accent/40 shadow-sm">
 <div class="max-w-5xl mx-auto px-4 py-3 flex flex-col sm:flex-row gap-3 sm:gap-4 sm:items-center sm:justify-between">
    <div class="flex items-center gap-2">
      <img src="/logo.png" alt="Logo C.U.R.A." class="h-16 w-auto object-contain shrink-0" />
      <div class="leading-tight">
        <p class="text-[11px] uppercase tracking-[0.25em] text-cura-accentLight">LEY NACIONAL</p>
        <p class="text-sm font-bold text-white">Transformación Digital Sanitaria Argentina</p>
      </div>
    </div>
    <nav class="flex items-center gap-4 text-sm font-medium whitespace-nowrap justify-center sm:justify-end mt-2 sm:mt-0">
      <a href="#inicio" class="text-cura-accentLight hover:text-white">Inicio</a>
      <a href="#informacion" class="text-cura-accentLight hover:text-white">Información</a>
      <a href="#contacto" class="text-cura-accentLight hover:text-white">Contacto</a>
      <a href="/random/demo-random.html" class="inline-flex items-center gap-1 text-cura-primary bg-cura-accent rounded-full px-3 py-1 text-xs font-semibold hover:bg-white transition">Demo Enfermero</a>
    </nav>
  </div>
</header>

  <main id="inicio" class="max-w-5xl mx-auto px-4 pt-10 pb-16 space-y-16">

    <section class="grid md:grid-cols-2 gap-10 items-center">
      <div>
        <p class="text-xs font-semibold tracking-[0.25em] text-cura-accentLight uppercase mb-3">LEY C.U.R.A.</p>
        <h1 class="text-3xl md:text-4xl font-extrabold text-white leading-tight mb-4 drop-shadow">Diseñando el futuro de la Salud Pública Argentina</h1>
        <p class="text-sm md:text-base text-cura-accentLight mb-6">Vos podés ser parte de la mayor transformación de la historia del sistema de Salud Digital Argentino.</p>
        <div class="flex flex-wrap gap-3">
          <button id="btn-sumate" type="button" class="inline-flex items-center justify-center px-4 py-2.5 rounded-full bg-white text-cura-primary text-sm font-semibold shadow-sm hover:bg-cura-accentLight hover:text-cura-primaryDark transition cursor-pointer">QUIERO SUMARME</button>
          <button id="btn-info" type="button" class="inline-flex items-center justify-center px-4 py-2.5 rounded-full border border-cura-accent text-sm font-semibold text-cura-accentLight hover:bg-cura-accent hover:text-cura-primary transition">Obtén más información</button>
        </div>
        <p class="mt-6 text-[11px] text-cura-accentLight">Creada para mejorar la salud de todos, sin importar la obra social, la provincia o el nivel de complejidad del centro de salud.</p>
      </div>

      <div class="relative w-full flex justify-center items-center perspective-container">
        <div class="absolute inset-0 bg-cura-accent/40 blur-3xl rounded-full -z-10 transform scale-90"></div>
        
        <div class="card-container animate-float">
          <div id="credencial-giratoria" class="card-inner">
            
            <div class="card-face card-front">
              <img src="credencial-frente-base.png" alt="Credencial Frente" class="card-bg-img">
              <div class="card-data-layer">
                 <div class="pos-nombre-front" id="cred-nombre-front"></div>
                 <div class="pos-dni-front" id="cred-dni-front"></div>
                 <div class="pos-sangre" id="cred-sangre"></div>
                 
                 <div class="data-block block-alergias centered-data" id="cred-alergias"></div>
                 <div class="data-block block-operaciones centered-data" id="cred-operaciones"></div>
                 <div class="data-block block-fecha-nac centered-data" id="cred-fecha-nac"></div>
                 
                 <div class="data-block block-medicamentos centered-data" id="cred-medicamentos"></div>
                 <div class="data-block block-domicilio centered-data" id="cred-domicilio"></div>
                 
                 <div class="data-block block-antecedentes centered-data" id="cred-antecedentes"></div>
                 <div class="data-block block-contactos centered-data" id="cred-contactos"></div>
              </div>
            </div>

            <div class="card-face card-back">
              <img src="credencial-dorso-base.png" alt="Credencial Dorso" class="card-bg-img">
              <div class="card-data-layer">
                  <div class="pos-nombre-back" id="cred-nombre-back"></div>
                  <div class="pos-dni-back" id="cred-dni-back"></div>
                  <div class="pos-id-number" id="cred-id-number"></div>
              </div>
            </div>

          </div>
        </div>
        <p class="absolute -bottom-10 text-center text-[11px] text-cura-accentLight animate-pulse opacity-80">(Hacé click en la credencial para girarla)</p>
      </div>
    </section>

    <section class="relative bg-cura-card border border-cura-accent/40 rounded-2xl shadow-xl p-6 md:p-8">
      <div class="absolute -top-6 -right-4 w-28 h-28 rounded-full bg-cura-accent/25 blur-2xl"></div>
      <div class="relative z-10 grid md:grid-cols-3 gap-6 items-start">
        <div class="md:col-span-1 space-y-3">
          <p class="text-xs font-semibold text-cura-accentLight uppercase tracking-wide">SISTEMA C.U.R.A.</p>
          <h2 class="text-xl font-bold text-white">Tu salud, simplificada y segura.</h2>
          <p class="text-sm text-white/90 leading-relaxed">La Ley C.U.R.A. crea la Credencial Única para que tu historia clínica viaje con vos. Un solo sistema que garantiza atención rápida, justa y sin papeles.</p>
        </div>
        <div class="md:col-span-2 grid sm:grid-cols-2 gap-3 text-xs text-cura-accentLight">
          <div class="bg-cura-primaryDark/30 border border-cura-accent/40 rounded-lg px-3 py-2"><strong class="text-white block mb-1">Acceso Inmediato</strong>Accedé a tu información médica desde cualquier lugar.</div>
          <div class="bg-cura-primaryDark/30 border border-cura-accent/40 rounded-lg px-3 py-2"><strong class="text-white block mb-1">Chau Papel</strong>Órdenes, recetas y estudios 100% digitales.</div>
          <div class="bg-cura-primaryDark/30 border border-cura-accent/40 rounded-lg px-3 py-2"><strong class="text-white block mb-1">Recetas Automáticas</strong>Firmas digitales al instante sin ir al consultorio.</div>
          <div class="bg-cura-primaryDark/30 border border-cura-accent/40 rounded-lg px-3 py-2"><strong class="text-white block mb-1">Emergencias QR</strong>Datos críticos escaneando tu credencial.</div>
          <div class="bg-cura-primaryDark/30 border border-cura-accent/40 rounded-lg px-3 py-2"><strong class="text-white block mb-1">Seguridad de Datos</strong>Privacidad garantizada y auditada.</div>
          <div class="bg-cura-primaryDark/30 border border-cura-accent/40 rounded-lg px-3 py-2"><strong class="text-white block mb-1">Reducción de Costos</strong>Menos burocracia, más inversión en salud.</div>
        </div>
      </div>
    </section>

    <section id="informacion" class="space-y-6">
      <div class="max-w-2xl"><h2 class="text-xl md:text-2xl font-bold text-white mb-2">Creada para mejorar la salud de todos</h2><p class="text-sm md:text-base text-cura-accentLight">La Ley C.U.R.A. impulsa un acceso más ágil, seguro y equitativo a la información clínica en todo el país.</p></div>
     <div class="grid md:grid-cols-3 gap-4">
      <div class="bg-cura-card rounded-xl border border-cura-accent/40 p-4 shadow-md"><h3 class="text-sm font-semibold text-white mb-1">Unificación</h3><p class="text-xs text-cura-accentLight">Un solo identificador de salud por persona, integrando datos de hospitales públicos, privados y de la seguridad social.</p></div>
      <div class="bg-cura-card rounded-xl border border-cura-accent/40 p-4 shadow-md"><h3 class="text-sm font-semibold text-white mb-1">Seguridad y privacidad</h3><p class="text-xs text-cura-accentLight">Accesos por niveles, auditorías y confidencialidad estricta de los datos de cada paciente.</p></div>
      <div class="bg-cura-card rounded-xl border border-cura-accent/40 p-4 shadow-md"><h3 class="text-sm font-semibold text-white mb-1">Interoperabilidad</h3><p class="text-xs text-cura-accentLight">LLeva tu historia clinica a donde sea que vayas, podrás acceder a tu historia clinica desde cualquier ciudad o provincia.</p></div>
     </div>
    </section>

    <section id="sumate" class="space-y-6">
      <div class="max-w-2xl"><h2 class="text-xl md:text-2xl font-bold text-white mb-2">Quiero sumarme</h2><p class="text-sm text-cura-accentLight">Completá tus datos para sumarte a la iniciativa.</p></div>
      <form id="sumate-form" action="https://formsubmit.co/ajax/contacto@leycura.org" method="POST" class="bg-cura-card border border-cura-accent/40 rounded-xl p-4 shadow-md space-y-3">
        <input type="hidden" name="_subject" value="Nuevo ciudadano sumado - LeyCURA"><input type="hidden" name="_template" value="box"><input type="hidden" name="_captcha" value="false">
        <div class="grid md:grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-red-400 mb-1">Nombre *</label><input name="nombre" required class="w-full border border-cura-accent/40 rounded-md px-2 py-1.5 text-sm text-cura-primary" /></div>
          <div><label class="block text-xs font-medium text-red-400 mb-1">Apellido *</label><input name="apellido" required class="w-full border border-cura-accent/40 rounded-md px-2 py-1.5 text-sm text-cura-primary" /></div>
        </div>
        <div class="grid md:grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-red-400 mb-1">Provincia *</label><select name="provincia" required class="w-full border border-cura-accent/40 rounded-md px-2 py-1.5 text-sm text-cura-primary bg-white text-cura-primary"><option value="">Seleccioná una provincia</option><option value="Buenos Aires">Buenos Aires</option><option value="Ciudad Autónoma de Buenos Aires">CABA</option></select></div>
          <div><label class="block text-xs font-medium text-red-400 mb-1">Ciudad *</label><select name="ciudad" id="ciudad-select" required class="w-full border border-cura-accent/40 rounded-md px-2 py-1.5 text-sm text-cura-primary bg-white text-cura-primary"><option value="">Seleccioná una ciudad</option></select></div>
        </div>
        <div><label class="block text-xs font-medium text-red-400 mb-1">Email de contacto *</label><input type="email" name="email" required class="w-full border border-cura-accent/40 rounded-md px-2 py-1.5 text-sm text-cura-primary" /></div>
        <button type="submit" class="w-full inline-flex justify-center items-center px-3 py-2 rounded-md bg-white text-cura-primary text-sm font-semibold">Enviar</button>
      </form>
    </section>

    <section id="contacto" class="space-y-6">
      <div class="max-w-2xl"><h2 class="text-xl md:text-2xl font-bold text-white mb-2">Comunícate con nosotros</h2><p class="text-sm text-cura-accentLight">Toda pregunta es válida.</p></div>
      <div class="grid md:grid-cols-2 gap-8 items-start">
        <div class="space-y-4"><div class="bg-cura-primaryDark border border-cura-accent/30 rounded-lg p-3 text-xs text-cura-accentLight">Tu apoyo se basa en informarte y difundir.</div></div>
        <form id="contact-form" class="bg-cura-card border border-cura-accent/40 rounded-xl p-4 shadow-md space-y-3" action="https://formsubmit.co/contacto@leycura.org" method="POST">
          <div><label class="block text-xs font-medium text-cura-accentLight mb-1">Correo electrónico *</label><input type="email" required name="email" class="w-full border border-cura-accent/40 rounded-md px-2 py-1.5 text-sm text-cura-primary" /></div>
          <div><label class="block text-xs font-medium text-cura-accentLight mb-1">Mensaje</label><textarea rows="4" name="mensaje" class="w-full border border-cura-accent/40 rounded-md px-2 py-1.5 text-sm text-cura-primary"></textarea></div>
          <button type="submit" class="w-full inline-flex justify-center items-center px-3 py-2 rounded-md bg-white text-cura-primary text-sm font-semibold">Enviar</button>
        </form>
      </div>
    </section>
  </main>

  <footer class="border-t border-cura-accent/30 bg-cura-primaryDark">
    <div class="max-w-5xl mx-auto px-4 py-6 flex flex-col md:flex-row items-center justify-between gap-3 text-[11px] text-cura-accentLight">
      <p>Copyright © 2025 C.U.R.A.</p>
    </div>
  </footer>

  <div id="success-modal" class="modal-backdrop fixed inset-0 bg-black/60 flex items-center justify-center z-40 hidden"><div class="modal-card bg-white rounded-2xl shadow-xl max-w-xs w-full p-6 text-center"><h2 class="text-lg font-semibold text-cura-primary mb-1">¡Gracias!</h2><button id="success-modal-ok" class="px-4 py-2 rounded-md bg-cura-primary text-white text-sm font-semibold">OK</button></div></div>
  
<script>
// Scripts originales del index (scroll, formularios, modales) - SIN CAMBIOS
document.addEventListener('DOMContentLoaded', function () {
  // (Aquí iría todo el bloque de scripts originales de georef, scroll suave, y manejo de formularios/modales que ya tenías)
  // Se omite para ahorrar espacio, pero debe estar presente.
  const provinciaSelect = document.querySelector('select[name="provincia"]'); const ciudadSelect = document.getElementById('ciudad-select'); async function cargarCiudades() { if (!provinciaSelect || !ciudadSelect) return; const prov = provinciaSelect.value; ciudadSelect.innerHTML = '<option value="">Cargando ciudades...</option>'; if (!prov) { ciudadSelect.innerHTML = '<option value="">Seleccioná una ciudad</option>'; return; } try { const url = 'https://apis.datos.gob.ar/georef/api/localidades?campos=nombre&max=5000&provincia=' + encodeURIComponent(prov); const res = await fetch(url); if (!res.ok) throw new Error(); const data = await res.json(); const localidades = (data.localidades || []).map(l => l.nombre).sort((a, b) => a.localeCompare(b, 'es')); ciudadSelect.innerHTML = '<option value="">Seleccioná una ciudad</option>'; localidades.forEach(nombre => { const opt = document.createElement('option'); opt.value = nombre; opt.textContent = nombre; ciudadSelect.appendChild(opt); }); } catch (e) { ciudadSelect.innerHTML = '<option value="">No se pudieron cargar las ciudades</option>'; } } if (provinciaSelect) { provinciaSelect.addEventListener('change', cargarCiudades); }
  const btnSumate=document.getElementById('btn-sumate'),targetSumate=document.getElementById('sumate'),btnInfo=document.getElementById('btn-info'),targetInfo=document.getElementById('informacion');function smoothScrollTo(e,t=1700,n=200){if(e){const o=e.getBoundingClientRect().top+window.pageYOffset-n,c=window.pageYOffset,r=o-c;let i=null;requestAnimationFrame(function e(n){i||(i=n);const o=n-i,a=Math.min(o/t,1),l=1-Math.pow(1-a,3);window.scrollTo(0,c+r*l),o<t&&requestAnimationFrame(e)})}}btnSumate&&targetSumate&&btnSumate.addEventListener('click',e=>{e.preventDefault(),smoothScrollTo(targetSumate)}),btnInfo&&targetInfo&&btnInfo.addEventListener('click',e=>{e.preventDefault(),smoothScrollTo(targetInfo)});
});
</script>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const card = document.getElementById('credencial-giratoria');
  if (card) { card.addEventListener('click', function() { this.classList.toggle('is-flipped'); }); }

  // Listas básicas
  const nombres = ["Juan", "María", "Carlos", "Ana", "Pedro", "Lucía", "Miguel", "Sofía", "Jorge", "Elena"];
  const apellidos = ["García", "Rodríguez", "López", "Martínez", "González", "Pérez", "Sánchez", "Romero"];
  const ciudades = ["CABA", "Córdoba", "Rosario", "Mendoza", "La Plata", "San Miguel de Tucumán"];
  const provincias = ["Buenos Aires", "Córdoba", "Santa Fe", "Mendoza", "Tucumán"];
  const tiposSangre = ["A+", "A-", "B+", "B-", "AB+", "AB-", "O+", "O-"];
  const alergiasBase = ["PENICILINA", "NÍQUEL", "POLEN", "ÁCAROS", "SULFAS", "LATEX"];
  const operacionesBase = ["APENDICECTOMÍA", "CESÁREA", "VESÍCULA", "PRÓTESIS RODILLA", "BYPASS GÁSTRICO"];

  // --- PERFILES MÉDICOS COHERENTES ---
  const perfilesMedicos = [
    { nombre: "Sano", antecedentes: [], medicamentos: [] },
    { nombre: "Hipertenso", antecedentes: ["HIPERTENSIÓN ARTERIAL"], medicamentos: ["ENALAPRIL", "LOSARTÁN", "AMLODIPINA", "HIDROCLOROTIAZIDA"] },
    { nombre: "Diabético Tipo 2", antecedentes: ["DIABETES TIPO 2"], medicamentos: ["METFORMINA", "GLIBENCLAMIDA", "INSULINA NPH"] },
    { nombre: "Asmático", antecedentes: ["ASMA BRONQUIAL"], medicamentos: ["SALBUTAMOL (SOS)", "BUDESONIDA INHALADOR"] },
    { nombre: "Cardiópata", antecedentes: ["INSUFICIENCIA CARDÍACA", "ARRITMIA"], medicamentos: ["CARVEDILOL", "FUROSEMIDA", "DIGOXINA", "ESPIRONOLACTONA"] },
    { nombre: "Hipotiroideo", antecedentes: ["HIPOTIROIDISMO"], medicamentos: ["LEVOTIROXINA SÓDICA"] },
    { nombre: "Perfil Complejo", antecedentes: ["HIPERTENSIÓN", "DIABETES TIPO 2", "DISLIPEMIA"], medicamentos: ["LOSARTÁN", "METFORMINA", "ATORVASTATINA", "ASPIRINA PREVENTIVA"] }
  ];

  // Funciones auxiliares
  function randItem(arr) { return arr[Math.floor(Math.random() * arr.length)]; }
  function randNum(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }
  function genDNI() { const num = randNum(10000000, 59999999).toString(); return `${num.slice(0, 2)}.${num.slice(2, 5)}.${num.slice(5)}`; }
  function genFechaNac() { const dia = String(randNum(1, 28)); const mes = ["ENERO", "FEBRERO", "MARZO", "ABRIL", "MAYO", "JUNIO", "JULIO", "AGOSTO", "SEPTIEMBRE", "OCTUBRE", "NOVIEMBRE", "DICIEMBRE"][randNum(0, 11)]; const anio = randNum(1950, 2005); return `${dia} ${mes} ${anio}`; }
  function genTel() { return `011 ${randNum(1000,9999)} ${randNum(1000,9999)}<br>011 ${randNum(1000,9999)} ${randNum(1000,9999)}`; }
  
  function pickSubset(sourceArray, maxItems) {
    if (!sourceArray || sourceArray.length === 0) return [];
    let result = [];
    let tempArray = [...sourceArray];
    const count = randNum(1, Math.min(maxItems, tempArray.length));
    for (let i = 0; i < count; i++) {
        const randomIndex = Math.floor(Math.random() * tempArray.length);
        result.push(tempArray.splice(randomIndex, 1)[0]);
    }
    return result;
  }

  // --- NUEVA FUNCIÓN PARA AJUSTAR TAMAÑO DE TEXTO ---
  function ajustarTexto(elementoId, tamanoInicialCQW) {
      const el = document.getElementById(elementoId);
      if (!el) return;

      // Convertimos el tamaño inicial de cqw a píxeles para poder reducirlo
      // Un valor aproximado, ya que no podemos obtener el valor computado exacto fácilmente
      let currentSize = tamanoInicialCQW; 
      el.style.fontSize = currentSize + "cqw";

      // Bucle para reducir el tamaño si se desborda
      // scrollHeight es la altura total del contenido, clientHeight es la altura visible del contenedor
      let safetyCounter = 0; // Para evitar bucles infinitos
      while (el.scrollHeight > el.clientHeight && safetyCounter < 20) {
          currentSize -= 0.1; // Reducimos en pasos pequeños
          el.style.fontSize = currentSize + "cqw";
          safetyCounter++;
      }
  }

  // --- LÓGICA PRINCIPAL DE POBLADO ---
  function poblarCredencial() {
    // 1. Datos personales básicos
    const nombre = randItem(nombres);
    const apellido = randItem(apellidos);
    const fullName = `${nombre} ${apellido}`;
    const dni = genDNI();

    // 2. Selección de Perfil Médico Coherente
    const perfil = randItem(perfilesMedicos);

    // 3. Generar Antecedentes
    let antecedentesTxt = "SIN PATOLOGÍAS REGISTRADAS";
    if (perfil.antecedentes.length > 0) {
        antecedentesTxt = perfil.antecedentes.join('<br>');
    }

    // 4. Generar Medicamentos
    let medsDelPerfil = [];
    if (perfil.medicamentos.length > 0) {
        medsDelPerfil = pickSubset(perfil.medicamentos, 2);
    }
    if (Math.random() > 0.8) {
        medsDelPerfil.push(randItem(["IBUPROFENO 600MG", "PARACETAMOL 1G"]));
    }
    let medicamentosTxt = "SIN MEDICACIÓN VITAL EN USO";
    if (medsDelPerfil.length > 0) {
        medicamentosTxt = [...new Set(medsDelPerfil)].join('<br>');
    }

    // 5. Generar otros datos
    const alergiasTxt = (Math.random() > 0.7) ? "NO REFIERE" : pickSubset(alergiasBase, 1).join('<br>');
    const operacionesTxt = (Math.random() > 0.6) ? "NINGUNA" : pickSubset(operacionesBase, 2).join('<br>');

    // 6. Llenar el DOM (Frente)
    document.getElementById('cred-nombre-front').textContent = fullName;
    document.getElementById('cred-dni-front').textContent = `D.N.I: ${dni}`;
    document.getElementById('cred-sangre').textContent = randItem(tiposSangre);
    document.getElementById('cred-fecha-nac').textContent = genFechaNac();
    document.getElementById('cred-domicilio').innerHTML = `${randItem(ciudades)}<br>${randItem(provincias)}`;
    document.getElementById('cred-contactos').innerHTML = genTel();

    // Llenar datos médicos
    const elAntecedentes = document.getElementById('cred-antecedentes');
    elAntecedentes.innerHTML = antecedentesTxt;

    const elMedicamentos = document.getElementById('cred-medicamentos');
    elMedicamentos.innerHTML = medicamentosTxt;

    document.getElementById('cred-alergias').innerHTML = alergiasTxt;
    document.getElementById('cred-operaciones').innerHTML = operacionesTxt;

    // 7. Llenar el DOM (Dorso)
    document.getElementById('cred-nombre-back').textContent = fullName;
    document.getElementById('cred-dni-back').textContent = `D.N.I: ${dni}`;
    document.getElementById('cred-id-number').textContent = `ID03-${dni.replace(/\./g, '')}`;

    // --- APLICAR AJUSTE DE TEXTO DESPUÉS DE LLENAR ---
    // Usamos setTimeout para dar tiempo a que el navegador renderice el texto y calcule las alturas
    setTimeout(() => {
        // Ajustamos Antecedentes y Medicamentos, que son los que pueden tener varias líneas
        ajustarTexto('cred-antecedentes', 2.1); // 2.1 es el tamaño base en cqw definido en el CSS
        ajustarTexto('cred-medicamentos', 2.1);
        // También podemos ajustar operaciones por si acaso
        ajustarTexto('cred-operaciones', 2.0);
    }, 50); // 50ms es suficiente espera
  }

  // Ejecutar al cargar
  poblarCredencial();
});
</script>
</body>
</html>
