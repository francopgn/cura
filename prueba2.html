<!DOCTYPE html> 
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
  <title>Ley C.U.R.A. | Diseñando el futuro de la Salud Pública Argentina</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@600&family=Vazirmatn:wght@400;700&family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            cura: {
              primary: '#004E85',      
              primaryDark: '#00345C',  
              card: '#065D9B',         
              accent: '#00C2FF',       
              accentLight: '#59D2FF'   
            }
          },
          fontFamily: { sans: ['Inter', 'sans-serif'] }
        }
      }
    }
  </script>

  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

<style>
  /* --- ESTILOS DE TRANSICIÓN Y BLUR --- */
  #main-layout {
    transition: filter 0.3s ease, transform 0.3s ease;
    will-change: filter;
  }
  
  .is-blurred {
    filter: blur(8px);
    pointer-events: none; /* Bloquea interacción con la web */
    user-select: none;
  }

  /* Asegura que el chat de Coze se vea nítido */
  .coze-web-chat-window-container {
    filter: none !important;
  }

  /* --- ESTILOS ORIGINALES (CREDENTIAL & 3D) --- */
  .perspective-container { perspective: 1500px; }
  .card-container { position: relative; width: 100%; max-width: 450px; aspect-ratio: 1.58 / 1; margin: 0 auto; z-index: 20; container-type: inline-size; }
  .card-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.8s cubic-bezier(0.2, 0.8, 0.2, 1); transform-style: preserve-3d; cursor: pointer; }
  .card-inner.is-flipped { transform: rotateY(180deg); }
  .card-face { position: absolute; top: 0; left: 0; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 18px; overflow: hidden; transform: translateZ(0); box-shadow: 0 20px 40px -5px rgba(0,0,0,0.4); }
  .card-bg-img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: 1; }
  .card-front { z-index: 2; transform: rotateY(0deg); }
  .card-back { z-index: 1; transform: rotateY(180deg); }
  @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
  .animate-float { animation: float 6s ease-in-out infinite; }
</style>
</head>

<body class="font-sans bg-cura-primary text-white overflow-x-hidden">

<div id="main-layout">
  <header class="sticky top-0 z-30 bg-cura-primaryDark text-white border-b border-cura-accent/40 shadow-sm">
    <div class="max-w-5xl mx-auto px-4 py-3 flex items-center justify-between">
      <a href="#inicio" class="flex items-center gap-2">
        <img src="/logo.png" alt="Logo" class="h-16 w-auto" />
        <div class="leading-tight">
          <p class="text-[11px] uppercase tracking-[0.25em] text-cura-accentLight">LEY NACIONAL</p>
          <p class="text-sm font-bold">Transformación Digital Sanitaria Argentina</p>
        </div>
      </a>
    </div>
  </header>

  <main id="inicio" class="max-w-5xl mx-auto px-4 pt-10 pb-16 space-y-16">
    <section class="grid md:grid-cols-2 gap-10 items-center">
      <div data-aos="fade-right">
        <h1 class="text-3xl md:text-4xl font-extrabold mb-4">Diseñando el futuro de la Salud Pública Argentina</h1>
        <div class="flex gap-3">
          <button id="btn-sumate" class="flex-1 px-4 py-2.5 rounded-full bg-white text-cura-primary font-bold">QUIERO SUMARME</button>
          <button id="btn-info" class="flex-1 px-4 py-2.5 rounded-full border border-cura-accent text-cura-accentLight font-bold">Información</button>
        </div>
      </div>
      
      <div class="card-container animate-float" data-aos="zoom-in">
        <div id="credencial-giratoria" class="card-inner">
          <div class="card-face card-front"><img src="credencial-frente-base.png" class="card-bg-img"></div>
          <div class="card-face card-back"><img src="credencial-dorso-base.png" class="card-bg-img"></div>
        </div>
      </div>
    </section>

    </main>
</div>

<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script src="https://unpkg.com/lenis@1.1.13/dist/lenis.min.js"></script> 
<script src="https://sf-cdn.coze.com/obj/unpkg-va/flow-platform/chat-app-sdk/1.2.0-beta.10/libs/oversea/index.js"></script>

<script>
// --- GLOBAL LENIS ---
let lenisInstance;

document.addEventListener('DOMContentLoaded', () => {
  // 1. Inicializar AOS
  AOS.init({ duration: 800, once: true });

  // 2. Inicializar Lenis
  lenisInstance = new Lenis({
    duration: 1.2,
    easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
    smoothWheel: true
  });

  function raf(time) {
    lenisInstance.raf(time);
    requestAnimationFrame(raf);
  }
  requestAnimationFrame(raf);

  // 3. Giro de Credencial
  const card = document.getElementById('credencial-giratoria');
  if(card) card.onclick = () => card.classList.toggle('is-flipped');

  // 4. Inicializar Coze
  new CozeWebSDK.WebChatClient({
    config: {
      type: 'bot',
      bot_id: '7596429833782214709',
      isIframe: false,
    },
    auth: {
      type: "token",
      token: "",
      onRefreshToken: async () => {
        const res = await fetch("/api/coze-token");
        const data = await res.json();
        return data.token;
      }
    },
    userInfo: { id: 'user_' + Date.now(), nickname: 'Ciudadano' },
    ui: {
      base: { layout: 'pc', lang: 'es', zIndex: 999999 },
      asstBtn: { isNeed: true },
      footer: { isShow: false },
      chatBot: { title: 'Asistente Ley C.U.R.A.', uploadable: false, width: 390 }
    },
  });

  // 5. LÓGICA DE DETECCIÓN, BLUR Y BLOQUEO
  const layout = document.getElementById('main-layout');

  const updateChatState = () => {
    // Buscamos si la ventana de chat está visible en el DOM
    const chatWin = document.querySelector('.coze-web-chat-window-pc');
    const isVisible = chatWin && !chatWin.classList.contains('coze-web-chat-window-hidden');

    if (isVisible) {
      if (lenisInstance) lenisInstance.stop();
      layout.classList.add('is-blurred');
      chatWin.setAttribute('data-lenis-prevent', 'true');
    } else {
      if (lenisInstance) lenisInstance.start();
      layout.classList.remove('is-blurred');
    }
  };

  // Observador para detectar cambios de clase en el body (cuando Coze abre la ventana)
  const observer = new MutationObserver((mutations) => {
    updateChatState();
  });

  observer.observe(document.body, { 
    childList: true, 
    subtree: true, 
    attributes: true 
  });

  // Fallback para asegurar respuesta rápida al click
  document.addEventListener('click', () => setTimeout(updateChatState, 150));
});
</script>

</body>
</html>
